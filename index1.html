<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Snake Game</title>

<style>
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-color: #111;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }

  h2 {
    margin: 8px 0;
  }

  #top-bar {
    display: flex;
    gap: 15px;
    align-items: center;
    margin-bottom: 10px;
  }

  #score {
    font-size: 18px;
  }

  button {
    background: #222;
    color: white;
    border: 1px solid #555;
    padding: 6px 10px;
    cursor: pointer;
  }

  button:hover {
    background: #333;
  }

  canvas {
    background-color: black;
    border: 2px solid white;
    touch-action: none;
  }

  /* Settings panel */
  #settings {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #181818;
    border: 2px solid white;
    padding: 20px;
    display: none;
    z-index: 10;
    min-width: 260px;
  }

  #settings h3 {
    margin-top: 0;
  }

  .setting {
    margin-bottom: 12px;
  }

  input[type="range"] {
    width: 100%;
  }

  select {
    width: 100%;
    padding: 4px;
    background: #222;
    color: white;
    border: 1px solid #555;
  }
</style>
</head>

<body>
<h2>Snake Game üêç</h2>

<div id="top-bar">
  <div id="score">Score: 0</div>
  <button id="settingsBtn">‚öô Settings</button>
</div>

<canvas id="game"></canvas>

<!-- Settings Panel -->
<div id="settings">
  <h3>Settings</h3>

  <div class="setting">
    <label>Game Speed</label>
    <input type="range" id="speedRange" min="60" max="300" step="10">
  </div>

  <div class="setting">
    <label>Controls</label>
    <select id="controlsSelect">
      <option value="wasd">WASD</option>
      <option value="arrows">Arrow Keys</option>
    </select>
  </div>

  <div class="setting">
    <label>
      <input type="checkbox" id="soundToggle"> Sound Effects
    </label>
  </div>

  <button id="closeSettings">Close</button>
</div>

<script>
/* =======================
   Canvas & UI
======================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");

const settingsPanel = document.getElementById("settings");
const settingsBtn = document.getElementById("settingsBtn");
const closeSettingsBtn = document.getElementById("closeSettings");

const speedRange = document.getElementById("speedRange");
const controlsSelect = document.getElementById("controlsSelect");
const soundToggle = document.getElementById("soundToggle");

const box = 20;

function resizeCanvas() {
  canvas.width = Math.floor((window.innerWidth - 40) / box) * box;
  canvas.height = Math.floor((window.innerHeight - 180) / box) * box;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* =======================
   Sounds
======================= */
const eatSound = new Audio("https://assets.codepen.io/21542/snack.wav");
const gameOverSound = new Audio("https://assets.codepen.io/21542/game-over.wav");

function playSound(sound) {
  if (!settings.sound) return;
  sound.currentTime = 0;
  sound.play();
}

/* =======================
   Settings (saved)
======================= */
let settings = {
  speed: 220,
  controls: "wasd",
  sound: true
};

Object.assign(settings, JSON.parse(localStorage.getItem("snakeSettings") || "{}"));

speedRange.value = settings.speed;
controlsSelect.value = settings.controls;
soundToggle.checked = settings.sound;

function saveSettings() {
  localStorage.setItem("snakeSettings", JSON.stringify(settings));
}

/* =======================
   Game State
======================= */
let snake = [{ x: box * 5, y: box * 5 }];
let direction = "right";
let nextDirection = "right";
let food = generateFood();
let score = 0;

let speed = settings.speed;
let minSpeed = 60;
let lastTime = 0;
let paused = false;

/* =======================
   Controls
======================= */
document.addEventListener("keydown", e => {
  if (paused) return;

  const key = e.key.toLowerCase();

  if (settings.controls === "wasd") {
    if (key === "w" && direction !== "down") nextDirection = "up";
    if (key === "s" && direction !== "up") nextDirection = "down";
    if (key === "a" && direction !== "right") nextDirection = "left";
    if (key === "d" && direction !== "left") nextDirection = "right";
  } else {
    if (key === "arrowup" && direction !== "down") nextDirection = "up";
    if (key === "arrowdown" && direction !== "up") nextDirection = "down";
    if (key === "arrowleft" && direction !== "right") nextDirection = "left";
    if (key === "arrowright" && direction !== "left") nextDirection = "right";
  }
});

/* Mobile swipe */
let touchStartX = 0;
let touchStartY = 0;

canvas.addEventListener("touchstart", e => {
  const t = e.touches[0];
  touchStartX = t.clientX;
  touchStartY = t.clientY;
});

canvas.addEventListener("touchend", e => {
  if (paused) return;

  const t = e.changedTouches[0];
  const dx = t.clientX - touchStartX;
  const dy = t.clientY - touchStartY;

  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 0 && direction !== "left") nextDirection = "right";
    if (dx < 0 && direction !== "right") nextDirection = "left";
  } else {
    if (dy > 0 && direction !== "up") nextDirection = "down";
    if (dy < 0 && direction !== "down") nextDirection = "up";
  }
});

/* =======================
   Game Logic
======================= */
function generateFood() {
  return {
    x: Math.floor(Math.random() * (canvas.width / box)) * box,
    y: Math.floor(Math.random() * (canvas.height / box)) * box
  };
}

function drawGame(timestamp) {
  if (paused) {
    requestAnimationFrame(drawGame);
    return;
  }

  if (timestamp - lastTime < speed) {
    requestAnimationFrame(drawGame);
    return;
  }
  lastTime = timestamp;

  direction = nextDirection;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  /* Food */
  ctx.beginPath();
  ctx.arc(food.x + box / 2, food.y + box / 2, box / 2, 0, Math.PI * 2);
  ctx.fillStyle = "red";
  ctx.fill();

  /* Snake */
  snake.forEach((part, index) => {
    ctx.fillStyle = index === 0 ? "#00ff88" : "#00aa55";
    ctx.beginPath();
    ctx.roundRect(part.x + 1, part.y + 1, box - 2, box - 2, 6);
    ctx.fill();
  });

  let head = { ...snake[0] };

  if (direction === "up") head.y -= box;
  if (direction === "down") head.y += box;
  if (direction === "left") head.x -= box;
  if (direction === "right") head.x += box;

  /* Wrap walls */
  if (head.x < 0) head.x = canvas.width - box;
  if (head.x >= canvas.width) head.x = 0;
  if (head.y < 0) head.y = canvas.height - box;
  if (head.y >= canvas.height) head.y = 0;

  /* Food collision */
  if (head.x === food.x && head.y === food.y) {
    score++;
    scoreEl.textContent = `Score: ${score}`;
    playSound(eatSound);
    food = generateFood();
    speed = Math.max(minSpeed, speed - 5);
  } else {
    snake.pop();
  }

  /* Self collision */
  if (snake.some(p => p.x === head.x && p.y === head.y)) {
    playSound(gameOverSound);
    alert(`Game Over üêç\nScore: ${score}`);
    location.reload();
  }

  snake.unshift(head);
  requestAnimationFrame(drawGame);
}

/* Rounded rect helper */
CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
  this.moveTo(x + r, y);
  this.arcTo(x + w, y, x + w, y + h, r);
  this.arcTo(x + w, y + h, x, y + h, r);
  this.arcTo(x, y + h, x, y, r);
  this.arcTo(x, y, x + w, y, r);
  this.closePath();
};

/* =======================
   Settings Events
======================= */
settingsBtn.onclick = () => {
  paused = true;
  settingsPanel.style.display = "block";
};

closeSettingsBtn.onclick = () => {
  paused = false;
  settingsPanel.style.display = "none";
};

speedRange.oninput = () => {
  settings.speed = Number(speedRange.value);
  speed = settings.speed;
  saveSettings();
};

controlsSelect.onchange = () => {
  settings.controls = controlsSelect.value;
  saveSettings();
};

soundToggle.onchange = () => {
  settings.sound = soundToggle.checked;
  saveSettings();
};

/* Start */
requestAnimationFrame(drawGame);
</script>
</body>
</html>
